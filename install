#!/usr/bin/env sh

ROOT="$(realpath "$(dirname "$0")")"
PKGNAME=${PKGNAME:-"dots"}

BINARY_NAME="$(echo "${PKGNAME}" | sed 's/-git//g')"

# override OS with a correct value with the given params
# creates variable `os`
. "${ROOT}"/util/os.sh

rm -rf "${DESTDIR}/opt/${PKGNAME}" \
    "${DESTDIR}/usr/bin/dots" \
    "${DESTDIR}/usr/share/licenses/${PKGNAME}/" \
    "${DESTDIR}/usr/share/doc/${PKGNAME}/"

install -d "${DESTDIR}/opt/${PKGNAME}"

for dirname in common "${os}" default-config scripts ui util; do
    cp -Rf "${ROOT}"/"${dirname}" "${DESTDIR}/opt/${PKGNAME}"
done

install -Dm644 "${ROOT}"/LICENSE -t "${DESTDIR}/usr/share/licenses/${PKGNAME}/"
install -Dm644 "${ROOT}"/README.md -t "${DESTDIR}/usr/share/doc/${PKGNAME}/"
install -Dm755 "${ROOT}"/dots -t "${DESTDIR}/opt/${PKGNAME}/"
ln -s "${DESTDIR}/opt/${PKGNAME}/dots" "${DESTDIR}/usr/bin/${BINARY_NAME}"
