#!/usr/bin/env bash

## Copyright (C) 2019-2025 Ulises Jeremias Cornejo Fandos
## Licensed under MIT.
##
## Waybar Weather Script
## Returns current weather information with icon and temperature
## Supports --tooltip flag for detailed information
## Supports --icon-only flag for vertical bars (space-constrained layouts)

# Check if dots-weather-info command exists
if ! command -v dots-weather-info &>/dev/null; then
  echo "󰼯"
  exit 0
fi

# Get weather information
weather_temp=$(dots-weather-info --temp 2>/dev/null)
weather_icon=$(dots-weather-info --icon 2>/dev/null)
weather_description=$(dots-weather-info --stat 2>/dev/null)
weather_location=$(dots-weather-info --loc 2>/dev/null)

# Return empty if weather info is not available
if [[ -z ${weather_temp} ]] || [[ -z ${weather_icon} ]]; then
  echo "󰼯"
  exit 0
fi

# Check if tooltip mode is requested
if [[ $1 == "--tooltip" ]]; then
  # Return detailed info for tooltip
  if [[ -n ${weather_description} ]] && [[ -n ${weather_location} ]]; then
    echo "${weather_location}"
    echo "${weather_description}"
    echo "Temperature: ${weather_temp}"
  else
    echo "Weather: ${weather_temp}"
  fi
  exit 0
fi

# Check if icon-only mode is requested (for vertical bars)
if [[ $1 == "--icon-only" ]]; then
  echo "${weather_icon}"
  exit 0
fi

# Check if text-only mode is requested
if [[ $1 == "--text-only" ]]; then
  echo "${weather_temp}"
  exit 0
fi

# Format output for Waybar
# Default mode: show icon and temperature
echo "${weather_icon} ${weather_temp}"
