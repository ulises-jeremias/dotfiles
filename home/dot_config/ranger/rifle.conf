# ╔══════════════════════════════════════════════════════════════════════════════╗
# ║              HorneroConfig — Ranger File Opener Rules (rifle.conf)          ║
# ║                                                                              ║
# ║  Rules for how ranger opens files. First matching rule wins.                 ║
# ║  Use 'r' key in ranger to choose an alternative opener.                      ║
# ║                                                                              ║
# ║  Format:  condition, condition, ... = command                                ║
# ║                                                                              ║
# ║  Conditions:                                                                 ║
# ║    ext <ext>      — file extension (case-insensitive)                        ║
# ║    mime <pattern> — MIME type (regex)                                         ║
# ║    has <cmd>      — command exists on system                                 ║
# ║    env <var>      — environment variable is set                              ║
# ║    flag <f|t>     — f=fork (background), t=terminal needed                  ║
# ║    label <name>   — named label for :open_with                               ║
# ║    number <n>     — nth rule for same match (for :open_with N)               ║
# ║    terminal       — requires a terminal                                      ║
# ║    else           — matches if no previous rule matched                      ║
# ║                                                                              ║
# ║  Wayland-native openers are preferred, with X11/fallback alternatives.       ║
# ╚══════════════════════════════════════════════════════════════════════════════╝

# ═══════════════════════════════════════════════════════════════════════════════
# ══ WEB CONTENT
# ═══════════════════════════════════════════════════════════════════════════════

# HTML files — open in browser or render in terminal
ext x?html?, has $BROWSER,          X, flag f = $BROWSER -- "$@"
ext x?html?, has firefox,           X, flag f = firefox -- "$@"
ext x?html?, has chromium,          X, flag f = chromium -- "$@"
ext x?html?, has w3m,                  terminal = w3m "$@"
ext x?html?, has lynx,                 terminal = lynx -- "$@"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ TEXT / CODE — Opened in $EDITOR
# ═══════════════════════════════════════════════════════════════════════════════

# Common code/config file extensions
mime ^text, label editor = ${VISUAL:-$EDITOR} -- "$@"
mime ^text, label pager  = "$PAGER" -- "$@"

# Config files, shell scripts, Makefiles, etc.
ext 1                         = man "$1"
ext s[wmf]c, has java, flag f = java -jar "$1"
ext s[wmf]c, has java         = java -jar "$1"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ IMAGES — Wayland-Native Viewers
# ═══════════════════════════════════════════════════════════════════════════════

# Image viewing — prefer Wayland-native viewers
mime ^image, has swayimg,  X, flag f = swayimg -- "$@"
mime ^image, has imv,      X, flag f = imv -- "$@"
mime ^image, has loupe,    X, flag f = loupe -- "$@"
mime ^image, has sxiv,     X, flag f = sxiv -- "$@"
mime ^image, has feh,      X, flag f = feh -- "$@"
mime ^image, has eog,      X, flag f = eog -- "$@"

# Image editing
mime ^image, has gimp,   X, flag f = gimp -- "$@"

# SVG editing
ext svg, has inkscape, X, flag f = inkscape -- "$@"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ VIDEO
# ═══════════════════════════════════════════════════════════════════════════════

mime ^video,       has mpv,      X, flag f = mpv -- "$@"
mime ^video,       has vlc,      X, flag f = vlc -- "$@"
mime ^video|audio, has celluloid, X, flag f = celluloid -- "$@"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ AUDIO
# ═══════════════════════════════════════════════════════════════════════════════

mime ^audio, has mpv,      X = mpv -- "$@"
mime ^audio, has vlc,      X, flag f = vlc -- "$@"
ext midi?,  has timidity,  X, flag f = timidity -- "$@"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ DOCUMENTS
# ═══════════════════════════════════════════════════════════════════════════════

# PDF — prefer lightweight viewers
ext pdf, has zathura,  X, flag f = zathura -- "$@"
ext pdf, has evince,   X, flag f = evince -- "$@"
ext pdf, has okular,   X, flag f = okular -- "$@"
ext pdf, has mupdf,    X, flag f = mupdf -- "$@"

# EPUB
ext epub, has zathura,   X, flag f = zathura -- "$@"
ext epub, has calibre,   X, flag f = ebook-viewer -- "$@"

# DJVU
ext djvu, has zathura,   X, flag f = zathura -- "$@"

# Office documents (LibreOffice)
ext pptx?|od[dfgpst]|docx?|sxc|xlsx?|xlt|xlw|gnm|gnumeric, has libreoffice, X, flag f = libreoffice "$@"

# CSV in LibreOffice Calc
ext csv, has libreoffice, X, flag f = libreoffice --calc "$@"
ext csv, label editor     = ${VISUAL:-$EDITOR} -- "$@"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ ARCHIVES — Extract or Browse
# ═══════════════════════════════════════════════════════════════════════════════

# Archive extraction (first choice: use ranger's :extract command)
ext 7z|ace|ar|arc|bz2?|cab|cpio|cpt|deb|dgc|dmg|gz,     has atool = atool --extract -- "$@"
ext iso|jar|msi|pkg|rar|shar|tar|tgz|xar|xpi|xz|zip|zst, has atool = atool --extract -- "$@"

# Browsing archives
ext tar|gz|bz2|xz|zst, has atool = atool --list -- "$@"
ext zip, has unzip = unzip -l -- "$@"
ext rar, has unrar = unrar l -- "$@"
ext 7z,  has 7z   = 7z l -- "$@"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ FONTS
# ═══════════════════════════════════════════════════════════════════════════════

ext otf|ttf|woff|woff2, has gnome-font-viewer, X, flag f = gnome-font-viewer "$@"
ext otf|ttf|woff|woff2, has fontforge,         X, flag f = fontforge "$@"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ SPECIAL FILE TYPES
# ═══════════════════════════════════════════════════════════════════════════════

# Torrent files
ext torrent, has transmission-gtk, X, flag f = transmission-gtk "$@"
ext torrent, has qbittorrent,      X, flag f = qbittorrent "$@"

# Jupyter notebooks — open in browser
ext ipynb, has jupyter,            X, flag f = jupyter notebook "$@"

# Databases
ext sqlite|sqlite3|db, has sqlitebrowser, X, flag f = sqlitebrowser "$@"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ EXECUTABLES / SCRIPTS
# ═══════════════════════════════════════════════════════════════════════════════

# Shell scripts — run or edit
mime application/x-executable = "$1"
ext sh|bash|zsh|fish, flag t = bash -- "$1"
ext py,  has python,  flag t = python -- "$1"
ext rb,  has ruby,    flag t = ruby -- "$1"
ext js,  has node,    flag t = node -- "$1"
ext lua, has lua,     flag t = lua -- "$1"

# ═══════════════════════════════════════════════════════════════════════════════
# ══ FALLBACKS — Universal Openers
# ═══════════════════════════════════════════════════════════════════════════════

# Use handlr (XDG default apps) as the primary fallback — integrates with
# the dots-default-apps system configured in this dotfiles setup.
has handlr, X, flag f = handlr open -- "$@"

# Standard XDG fallbacks
has xdg-open, X, flag f = xdg-open -- "$@"
has open,     X, flag f = open -- "$@"

# Last resort: open in $EDITOR (for text-like files)
label editor, !mime ^image, !mime ^video, !mime ^audio, !ext pdf = ${VISUAL:-$EDITOR} -- "$@"
label pager,  !mime ^image, !mime ^video, !mime ^audio, !ext pdf = "$PAGER" -- "$@"
