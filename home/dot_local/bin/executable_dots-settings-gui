#!/usr/bin/env bash

## Copyright (C) 2019-2025 Ulises Jeremias Cornejo Fandos
## Licensed under MIT.
##
## Settings GUI - Quickshell control center entrypoint

set -euo pipefail

SCRIPT_NAME="$(basename "$0")"
readonly SCRIPT_NAME

open_settings() {
  if ! pgrep -x quickshell >/dev/null 2>&1; then
    ~/.local/bin/dots-quickshell start >/dev/null 2>&1 || true
    sleep 1
  fi

  if pgrep -x quickshell >/dev/null 2>&1; then
    ~/.local/bin/dots-quickshell ipc utilities toggle
    return 0
  fi

  echo "Error: quickshell is not running and could not be started" >&2
  return 1
}

# Main
main() {
  case "${1:-menu}" in
    menu | --menu | -m | "")
      open_settings
      ;;
    help | --help | -h)
      cat <<EOF
Usage: $SCRIPT_NAME [COMMAND]

Central settings hub for system configuration.

Commands:
  menu, -m        Show settings menu (default)
  help, -h        Show this help message

Keybinding suggestion (hyprland):
  bind = SUPER, I, exec, $SCRIPT_NAME menu
  bind = SUPER SHIFT, S, exec, $SCRIPT_NAME menu
EOF
      ;;
    *)
      echo "Unknown command: $1" >&2
      echo "Try '$SCRIPT_NAME help' for more information." >&2
      exit 1
      ;;
  esac
}

main "$@"
