#!/usr/bin/env bash

## Copyright (C) 2019-2022 Ulises Jeremias Cornejo Fandos
## Licensed under MIT.
##
## Check full documentation at: https://github.com/ulises-jeremias/dotfiles/wiki
##
##     @script.name [OPTION] ARGUMENTS...
##
## Options:
##     -h, --help                            Help.
##     -c, --clear                           Will remove existing dotfiles.
##     -u, --upgrade                         Will update dependencies anyway.
##         --dry-run                         Will not install anything. Just will create the dotfiles dir.
##         --nodeps                          Will not install dependencies.
##         --nodunst                         Notifications will use xfce4-notifyd instead.
##         --utils                           Will answer you to install some utilities.
##         --bluetooth                       Will add bluetooth to the dependencies added.
##
##         --os=OS_NAME                      Operating System. Posible values: arch-linux | debian.
##                                           By default, the installation script will determine which is your OS.
##         --wms=COMMA_SEPARATED_WMS         Window managers. Posible wms: i3, openbox
##         --log-file=LOG_FILE_PATH          Logs file path, is /tmp/dots_install_log_$(date +'%m-%d-%y_%H:%M:%S').txt by default.
##         --dotfiles-dir=OUTPUT_PATH        Dotfiles output dir, is ~/dotfiles by default.
##

set -e

ROOT="$(realpath "$(dirname "$0")")"

XDG_CONFIG_HOME="${XDG_CONFIG_HOME:-$HOME/.config}"
export XDG_CONFIG_HOME

if [[ "$ROOT" = "/usr/bin" && -d /opt/dots ]]; then
    ROOT=/opt/dots
fi

. "${ROOT}"/util/easy-options/easyoptions.sh

# override OS with a correct value with the given params
. "${ROOT}"/util/os.sh

echo "Installing dotfiles for OS: ${os}"

# load deps for give os. Defines pkgs variable
. "${ROOT}"/"${os}"/deps.sh

args="$*"
args=( "${args/--utils/}" )
args=( "${args/--nodunst/}" )
args=( "${args/--bluetooth/}" )

"${ROOT}"/scripts/install ${args[*]} --pkgs="${pkgs}"
