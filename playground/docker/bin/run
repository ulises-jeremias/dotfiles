#!/usr/bin/env bash

## Copyright (C) 2019-2022 Ulises Jeremias Cornejo Fandos
## Licensed under MIT
##
## IMPORTANT: Remember to read the files in `docs/docker` before updating this file
##
##     @script.name [OPTION] ARGUMENTS...
##
## Options:
##     -h, --help                            Help.
##         --build                           Build the docker compose.
##         --remove                          Remove the docker compose.
##
##         --os=OS_NAME                      Operating System. Posible values: arch-linux | debian
##         --wm=WINDOW_MANAGER               Window manager. Posible values: i3 | openbox
##

set -e

ROOT=$(dirname "$0")
DOCKER_DIR="$(realpath "${ROOT}/../")"

source "${ROOT}/../../util/easy-options/easyoptions.sh" || exit
source "${ROOT}/../../util/logs.sh" || exit


#==========================================
# Default argument values and preprocessing
#==========================================
time_str=$(date +'%m-%d-%y_%H:%M:%S')
os=${os:-"arch-linux"}
wm=${wm:-"i3"}


[ ! -f "${log_file}" ] && touch "${log_file}"

cd "${DOCKER_DIR}" || exit

[ -n "${build}" ] && command="build"
[ -n "${remove}" ] && command="down"

OS="${os}" WM="${wm}" docker-compose -f "${DOCKER_DIR}/docker-compose.yml" "${command}" 2>&1 | tee -a "${log_file}"

# Help shown by default
[[ -z "${documentation}" ]] && parse_documentation
echo "${documentation}"
